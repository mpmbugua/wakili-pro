generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AppSetting {
  id        String   @id
  key       String   @unique
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime
}

model DocumentTemplate {
  id                 String              @id @default(cuid())
  type               String
  name               String
  description        String
  template           String
  priceKES           Int?
  isActive           Boolean?            @default(true)
  isPublic           Boolean?            @default(false)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  consultationId     String
  url                String
  fileName           String?
  storageKey         String?
  uploadedAt         DateTime?
  duration           Int?
  fileSize           Int?
  format             String?
  recordingStartedAt DateTime?
  DocumentPurchase   DocumentPurchase[]
  DocumentReview     DocumentReview[]
  DocumentVersion    DocumentVersion[]
  Payment            Payment[]
  PurchaseLimit      PurchaseLimit[]
  userDocuments      UserDocument[]      @relation("DocumentFromTemplate")
  VideoConsultation  VideoConsultation[]
}

model DocumentPurchase {
  id               String           @id @default(cuid())
  userId           String
  amount           Float
  type             String
  content          String
  description      String
  status           String           @default("PENDING")
  template         String
  createdAt        DateTime         @default(now())
  updatedAt        DateTime
  referenceId      String?
  bookingId        String?
  documentId       String
  ServiceBooking   ServiceBooking?  @relation(fields: [bookingId], references: [id])
  DocumentTemplate DocumentTemplate @relation(fields: [documentId], references: [id])
  user             User             @relation("UserDocumentPurchases", fields: [userId], references: [id])
}

model ConsultationRecording {
  id                                        String            @id @default(cuid())
  clientId                                  String
  consultationId                            String
  url                                       String
  fileName                                  String?
  storageKey                                String?
  lawyerId                                  String
  uploadedAt                                DateTime?
  createdAt                                 DateTime          @default(now())
  duration                                  Int?
  fileSize                                  Int?
  format                                    String?
  recordingStartedAt                        DateTime?
  recordingEndedAt                          DateTime?
  User_ConsultationRecording_clientIdToUser User              @relation("ConsultationRecording_clientIdToUser", fields: [clientId], references: [id])
  VideoConsultation                         VideoConsultation @relation(fields: [consultationId], references: [id])
  User_ConsultationRecording_lawyerIdToUser User              @relation("ConsultationRecording_lawyerIdToUser", fields: [lawyerId], references: [id])
}

model DeviceRegistration {
  id          String    @id @default(cuid())
  userId      String
  deviceId    String
  deviceToken String?
  platform    String
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  appVersion  String?
  lastSeen    DateTime?
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model RefreshToken {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  createdAt DateTime @default(now())
  expiresAt DateTime
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model LawyerProfile {
  id                                  String              @id @default(cuid())
  providerId                          String              @unique
  userId                              String              @unique
  licenseNumber                       String?             @unique
  tier                                LawyerTier?         @default(FREE)
  specializations                     String[]
  phoneNumber                         String?
  yearOfAdmission                     Int?
  location                            String?
  linkedInProfile                     String?
  profileImageUrl                     String?
  bio                                 String?
  yearsOfExperience                   Int?
  availability                        Json?
  isVerified                          Boolean             @default(false)
  rating                              Float?              @default(0)
  reviewCount                         Int?                @default(0)
  isFeatured                          Boolean             @default(false)
  featuredUntil                       DateTime?
  status                              String?             @default("ACTIVE")
  hourlyRate                          Decimal?            @db.Decimal(10, 2)
  offPeakHourlyRate                   Decimal?            @db.Decimal(10, 2)
  available24_7                       Boolean             @default(false)
  workingHours                        Json?
  blockedSlots                        Json?
  googleCalendarConnected             Boolean             @default(false)
  googleCalendarId                    String?
  outlookCalendarConnected            Boolean             @default(false)
  outlookCalendarId                   String?
  calendarSyncEnabled                 Boolean             @default(false)
  lastCalendarSync                    DateTime?
  createdAt                           DateTime            @default(now())
  updatedAt                           DateTime            @updatedAt
  User_LawyerProfile_providerIdToUser User                @relation("LawyerProfile_providerIdToUser", fields: [providerId], references: [id])
  user                                User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  wallet                              LawyerWallet?
  ServiceBooking                      ServiceBooking[]
  withdrawalRequests                  WithdrawalRequest[]
}

model User {
  id                                                         String                    @id @default(cuid())
  createdAt                                                  DateTime                  @default(now())
  email                                                      String                    @unique
  emailVerified                                              Boolean                   @default(false)
  firstName                                                  String
  lastName                                                   String
  password                                                   String?
  passwordResetExpires                                       DateTime?
  passwordResetToken                                         String?
  phoneNumber                                                String?
  profileImageUrl                                            String?
  role                                                       String
  updatedAt                                                  DateTime                  @updatedAt
  verificationStatus                                         String?                   @default("PENDING")
  onlineStatus                                               String?                   @default("offline")
  lastSeen                                                   DateTime?
  aiQueries                                                  AIQuery[]                 @relation("UserAIQueries")
  Article                                                    Article[]
  AuditLog                                                   AuditLog[]
  Badge                                                      Badge[]
  handledCallLogs                                            CallLog[]                 @relation("HandledCallLogs")
  ChatMessage_ChatMessage_clientIdToUser                     ChatMessage[]             @relation("ChatMessage_clientIdToUser")
  messagesSent                                               ChatMessage[]             @relation("MessageSender")
  chatRoomsAsClient                                          ChatRoom[]                @relation("ChatClient")
  chatRoomsAsLawyer                                          ChatRoom[]                @relation("ChatLawyer")
  consultationBookingsAsClient                               ConsultationBooking[]     @relation("ClientConsultationBookings")
  consultationBookingsAsLawyer                               ConsultationBooking[]     @relation("LawyerConsultationBookings")
  ConsultationRecording_ConsultationRecording_clientIdToUser ConsultationRecording[]   @relation("ConsultationRecording_clientIdToUser")
  ConsultationRecording_ConsultationRecording_lawyerIdToUser ConsultationRecording[]   @relation("ConsultationRecording_lawyerIdToUser")
  conversationParticipants                                   ConversationParticipant[] @relation("ConversationParticipants")
  deviceRegistrations                                        DeviceRegistration[]
  documentPurchases                                          DocumentPurchase[]        @relation("UserDocumentPurchases")
  documentReviewsAsLawyer                                    DocumentReview[]          @relation("DocumentReviewLawyer")
  documentReviewsAsQC                                        DocumentReview[]          @relation("DocumentReviewQC")
  documentReviewsAsUser                                      DocumentReview[]          @relation("DocumentReviewUser")
  Favorite                                                   Favorite[]
  FeatureEvent                                               FeatureEvent[]
  letterheadApprovals                                        LawyerLetterhead[]        @relation("LetterheadApprover")
  lawyerLetterhead                                           LawyerLetterhead?         @relation("LawyerLetterhead")
  LawyerProfile_LawyerProfile_providerIdToUser               LawyerProfile?            @relation("LawyerProfile_providerIdToUser")
  lawyerProfile                                              LawyerProfile?
  lawyerQuotes                                               LawyerQuote[]             @relation("LawyerQuotes")
  LawyerSubscription                                         LawyerSubscription[]
  uploadedLegalDocuments                                     LegalDocument[]           @relation("UploadedLegalDocuments")
  LoyaltyPoint                                               LoyaltyPoint[]
  servicesOffered                                            MarketplaceService[]      @relation("ServiceProvider")
  directMessages                                             Message[]                 @relation("DirectMessagesSent")
  notifications                                              Notification[]
  payments                                                   Payment[]
  PurchaseLimit                                              PurchaseLimit[]
  Referral_Referral_refereeIdToUser                          Referral[]                @relation("Referral_refereeIdToUser")
  Referral_Referral_referrerIdToUser                         Referral[]                @relation("Referral_referrerIdToUser")
  refreshTokens                                              RefreshToken[]
  refundsRequested                                           Refund[]
  bookingsAsClient                                           ServiceBooking[]          @relation("ServiceClient")
  bookingsAsProvider                                         ServiceBooking[]          @relation("ServiceProvider")
  ServiceBooking_ServiceBooking_userIdToUser                 ServiceBooking[]          @relation("ServiceBooking_userIdToUser")
  selectedLawyerRequests                                     ServiceRequest[]          @relation("SelectedLawyerRequests")
  clientServiceRequests                                      ServiceRequest[]          @relation("ClientServiceRequests")
  reviewsGiven                                               ServiceReview[]           @relation("ReviewAuthor")
  reviewsReceived                                            ServiceReview[]           @relation("ReviewTarget")
  documents                                                  UserDocument[]            @relation("UserDocuments")
  profile                                                    UserProfile?
  clientConsultations                                        VideoConsultation[]       @relation("ClientConsultations")
  lawyerConsultations                                        VideoConsultation[]       @relation("LawyerConsultations")
  VideoConsultation_VideoConsultation_providerIdToUser       VideoConsultation[]       @relation("VideoConsultation_providerIdToUser")
  VideoConsultation_VideoConsultation_userIdToUser           VideoConsultation[]       @relation("VideoConsultation_userIdToUser")
  videoParticipants                                          VideoParticipant[]
  walletTransactions                                         WalletTransaction[]
}

model UserProfile {
  id                    String   @id @default(cuid())
  userId                String   @unique
  emailNotifications    Boolean  @default(true)
  smsNotifications      Boolean  @default(true)
  pushNotifications     Boolean  @default(true)
  consultationReminders Boolean  @default(true)
  profileVisibility     Boolean  @default(true)
  showActivityStatus    Boolean  @default(true)
  dataAnalytics         Boolean  @default(true)
  language              String   @default("en")
  timezone              String   @default("Africa/Nairobi")
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  user                  User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model UserDocument {
  id         String            @id @default(cuid())
  userId     String
  title      String
  type       DocumentType
  category   String?
  fileUrl    String
  fileSize   Int
  fileName   String
  mimeType   String
  status     DocumentStatus
  source     DocumentSource
  templateId String?
  uploadedAt DateTime          @default(now())
  updatedAt  DateTime          @updatedAt
  deletedAt  DateTime?
  reviews    DocumentReview[]  @relation("UserDocumentReviews")
  template   DocumentTemplate? @relation("DocumentFromTemplate", fields: [templateId], references: [id])
  user       User              @relation("UserDocuments", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([type])
}

model VideoParticipant {
  id                String            @id @default(uuid())
  consultationId    String
  userId            String
  participantType   String?
  connectionStatus  String?           @default("DISCONNECTED")
  hasVideo          Boolean           @default(false)
  joinedAt          DateTime          @default(now())
  leftAt            DateTime?
  isActive          Boolean           @default(true)
  hasAudio          Boolean           @default(false)
  videoConsultation VideoConsultation @relation(fields: [consultationId], references: [id])
  user              User              @relation(fields: [userId], references: [id], map: "VideoParticipant_userId_as_participant_fkey")
}

model MarketplaceService {
  id                    String                   @id @default(cuid())
  title                 String
  type                  MarketplaceServiceType
  providerId            String
  description           String?
  price                 Float
  priceKES              Int?
  tags                  String[]
  status                MarketplaceServiceStatus @default(ACTIVE)
  rating                Float?                   @default(0)
  createdAt             DateTime                 @default(now())
  externalTransactionId String?
  updatedAt             DateTime                 @updatedAt
  duration              Int?
  deliveryTimeframe     String?
  provider              User                     @relation("ServiceProvider", fields: [providerId], references: [id], onDelete: Cascade)
  bookings              ServiceBooking[]
  reviews               ServiceReview[]
}

model ServiceBooking {
  id                               String               @id @default(cuid())
  userId                           String
  lawyerId                         String
  clientId                         String?
  providerId                       String
  serviceId                        String
  status                           ServiceBookingStatus
  scheduledAt                      DateTime
  completedAt                      DateTime?
  createdAt                        DateTime             @default(now())
  updatedAt                        DateTime             @updatedAt
  totalAmountKES                   Int?
  paymentStatus                    PaymentStatus?
  clientRequirements               String?
  providerNotes                    String?
  chatRooms                        ChatRoom[]
  DocumentPurchase                 DocumentPurchase[]
  payments                         Payment[]
  client                           User?                @relation("ServiceClient", fields: [clientId], references: [id])
  lawyerProfile                    LawyerProfile        @relation(fields: [lawyerId], references: [providerId], map: "ServiceBooking_lawyerProfileId_fkey")
  provider                         User                 @relation("ServiceProvider", fields: [providerId], references: [id])
  service                          MarketplaceService   @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  User_ServiceBooking_userIdToUser User                 @relation("ServiceBooking_userIdToUser", fields: [userId], references: [id], onDelete: Cascade)
  videoConsultation                VideoConsultation[]
  WalletTransaction                WalletTransaction[]
}

model ServiceReview {
  id        String             @id @default(cuid())
  serviceId String
  authorId  String
  targetId  String
  rating    Int
  comment   String
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt
  author    User               @relation("ReviewAuthor", fields: [authorId], references: [id])
  service   MarketplaceService @relation(fields: [serviceId], references: [id])
  target    User               @relation("ReviewTarget", fields: [targetId], references: [id])
}

model Payment {
  priceKES              Int?
  createdAt             DateTime           @default(now())
  updatedAt             DateTime           @updatedAt
  appVersion            String?
  lastSeen              DateTime?
  id                    String             @id @default(cuid())
  userId                String
  documentId            String?
  bookingId             String?
  documentReviewId      String?
  type                  PaymentType
  targetId              String?
  amount                Int
  currency              String             @default("USD")
  status                PaymentStatus
  provider              String
  transactionId         String?
  method                PaymentMethod?
  externalTransactionId String?
  verifiedAt            DateTime?
  errorMessage          String?
  metadata              Json?
  EscrowTransaction     EscrowTransaction?
  booking               ServiceBooking?    @relation(fields: [bookingId], references: [id])
  DocumentTemplate      DocumentTemplate?  @relation(fields: [documentId], references: [id])
  documentReview        DocumentReview?    @relation(fields: [documentReviewId], references: [id])
  user                  User               @relation(fields: [userId], references: [id])
  refunds               Refund[]
}

model Refund {
  releasedAt       DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  id               String    @id @default(cuid())
  paymentId        String
  userId           String
  amount           Float
  reason           String
  status           String
  externalRefundId String?
  requestedBy      String?
  payment          Payment   @relation(fields: [paymentId], references: [id], onDelete: Cascade)
  user             User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model WalletTransaction {
  referenceId    String?
  id             String          @id @default(cuid())
  userId         String
  amount         Float
  type           String
  status         String
  description    String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  bookingId      String?
  ServiceBooking ServiceBooking? @relation(fields: [bookingId], references: [id])
  user           User            @relation(fields: [userId], references: [id])
}

model Notification {
  id        String           @id @default(cuid())
  userId    String
  type      NotificationType
  title     String?
  message   String?
  createdAt DateTime         @default(now())
  isRead    Boolean          @default(false)
  readAt    DateTime?
  user      User             @relation(fields: [userId], references: [id])
}

model ChatRoom {
  id           String         @id @default(cuid())
  name         String
  clientId     String
  lawyerId     String
  bookingId    String
  status       String         @default("ACTIVE")
  lastActivity DateTime?      @default(now())
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  messages     ChatMessage[]
  booking      ServiceBooking @relation(fields: [bookingId], references: [id])
  client       User           @relation("ChatClient", fields: [clientId], references: [id], onDelete: Cascade)
  lawyer       User           @relation("ChatLawyer", fields: [lawyerId], references: [id], onDelete: Cascade)
}

model ChatMessage {
  id                              String    @id @default(cuid())
  roomId                          String
  senderId                        String
  clientId                        String
  messageType                     String    @default("TEXT")
  content                         String?
  fileUrl                         String?
  fileName                        String?
  fileSize                        Int?
  isRead                          Boolean   @default(false)
  createdAt                       DateTime  @default(now())
  editedAt                        DateTime?
  User_ChatMessage_clientIdToUser User      @relation("ChatMessage_clientIdToUser", fields: [clientId], references: [id])
  room                            ChatRoom  @relation(fields: [roomId], references: [id])
  sender                          User      @relation("MessageSender", fields: [senderId], references: [id], onDelete: Cascade)
}

model VideoConsultation {
  duration                                Int?
  id                                      String                  @id @default(uuid())
  roomId                                  String                  @unique
  userId                                  String
  amount                                  Float
  type                                    VideoConsultationType
  status                                  VideoConsultationStatus
  description                             String?
  createdAt                               DateTime                @default(now())
  updatedAt                               DateTime                @updatedAt
  referenceId                             String?
  startedAt                               DateTime?
  scheduledAt                             DateTime?
  endedAt                                 DateTime?
  isRecorded                              Boolean?                @default(false)
  bookingId                               String?
  documentId                              String
  providerId                              String?
  clientId                                String?
  lawyerId                                String?
  participantCount                        Int?
  ConsultationRecording                   ConsultationRecording[]
  booking                                 ServiceBooking?         @relation(fields: [bookingId], references: [id])
  client                                  User?                   @relation("ClientConsultations", fields: [clientId], references: [id])
  DocumentTemplate                        DocumentTemplate        @relation(fields: [documentId], references: [id])
  lawyer                                  User?                   @relation("LawyerConsultations", fields: [lawyerId], references: [id])
  User_VideoConsultation_providerIdToUser User?                   @relation("VideoConsultation_providerIdToUser", fields: [providerId], references: [id])
  User_VideoConsultation_userIdToUser     User                    @relation("VideoConsultation_userIdToUser", fields: [userId], references: [id])
  participants                            VideoParticipant[]
}

model AIQuery {
  id        String   @id @default(cuid())
  userId    String
  query     String
  createdAt DateTime @default(now())
  user      User     @relation("UserAIQueries", fields: [userId], references: [id], onDelete: Cascade)
}

model Article {
  id           String    @id @default(cuid())
  authorId     String
  title        String
  content      String
  fileName     String?
  isPremium    Boolean   @default(false)
  premiumUntil DateTime?
  isPublished  Boolean   @default(false)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  User         User      @relation(fields: [authorId], references: [id], onDelete: Cascade)

  @@index([authorId])
  @@index([isPublished])
  @@index([createdAt])
}

model AuditLog {
  id     String @id
  userId String
  User   User   @relation(fields: [userId], references: [id])
}

model Badge {
  id        String   @id
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime
  User      User     @relation(fields: [userId], references: [id])
}

model DocumentVersion {
  id               String           @id
  documentId       String
  DocumentTemplate DocumentTemplate @relation(fields: [documentId], references: [id])
}

model EscrowTransaction {
  status      String?
  createdAt   DateTime  @default(now())
  id          String    @id
  paymentId   String    @unique
  amount      Float
  updatedAt   DateTime
  releaseDate DateTime?
  Payment     Payment   @relation(fields: [paymentId], references: [id])
}

model Favorite {
  id     String @id
  userId String
  User   User   @relation(fields: [userId], references: [id])
}

model FeatureEvent {
  id        String   @id
  userId    String
  type      String
  details   Json?
  createdAt DateTime @default(now())
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model LawyerSubscription {
  id          String             @id
  userId      String
  plan        SubscriptionPlan
  status      SubscriptionStatus @default(PENDING)
  priceKES    Int
  startDate   DateTime
  endDate     DateTime
  paymentInfo Json?
  updatedAt   DateTime
  User        User               @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model LoyaltyPoint {
  id        String   @id
  userId    String
  points    Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model PurchaseLimit {
  id               String            @id
  userId           String
  templateId       String?
  updatedAt        DateTime
  DocumentTemplate DocumentTemplate? @relation(fields: [templateId], references: [id])
  User             User              @relation(fields: [userId], references: [id])
}

model Referral {
  id                             String @id
  referrerId                     String
  refereeId                      String
  User_Referral_refereeIdToUser  User   @relation("Referral_refereeIdToUser", fields: [refereeId], references: [id])
  User_Referral_referrerIdToUser User   @relation("Referral_referrerIdToUser", fields: [referrerId], references: [id])
}

model DocumentReview {
  id                     String                @id @default(cuid())
  userId                 String
  lawyerId               String?
  documentSource         DocumentOrigin
  marketplaceDocumentId  String?
  userDocumentId         String?
  uploadedDocumentUrl    String?
  originalFileName       String?
  documentType           String
  documentCategory       DocumentCategory?
  reviewType             ReviewType
  aiReviewStatus         AIReviewStatus        @default(PENDING)
  aiReviewResults        Json?
  aiReviewCompletedAt    DateTime?
  certificationStatus    CertificationStatus?
  certificationPrice     Float?
  certifiedDocumentUrl   String?
  certificationLetterUrl String?
  lawyerNotes            String?
  certificateId          String?               @unique
  verificationQRCodeUrl  String?
  signedAt               DateTime?
  signatureApplied       Boolean               @default(false)
  stampApplied           Boolean               @default(false)
  letterheadApplied      Boolean               @default(false)
  questionnaire          Json?
  urgency                UrgencyLevel          @default(STANDARD)
  deadline               DateTime
  price                  Float
  paymentId              String?
  paidAt                 DateTime?
  status                 String                @default("pending_payment")
  assignedAt             DateTime?
  estimatedDeliveryDate  DateTime?
  qualityControlStatus   QualityControlStatus?
  qualityControlNotes    String?
  qualityCheckedBy       String?
  qualityCheckedAt       DateTime?
  completedAt            DateTime?
  deliveredAt            DateTime?
  clientRating           Int?
  clientFeedback         String?
  revisionCount          Int                   @default(0)
  revisionRequested      Boolean               @default(false)
  revisionNotes          String?
  createdAt              DateTime              @default(now())
  updatedAt              DateTime              @updatedAt
  lawyer                 User?                 @relation("DocumentReviewLawyer", fields: [lawyerId], references: [id])
  marketplaceDocument    DocumentTemplate?     @relation(fields: [marketplaceDocumentId], references: [id])
  qualityController      User?                 @relation("DocumentReviewQC", fields: [qualityCheckedBy], references: [id])
  userDocument           UserDocument?         @relation("UserDocumentReviews", fields: [userDocumentId], references: [id])
  user                   User                  @relation("DocumentReviewUser", fields: [userId], references: [id])
  payments               Payment[]

  @@index([userId])
  @@index([lawyerId])
  @@index([aiReviewStatus])
  @@index([certificationStatus])
  @@index([qualityControlStatus])
  @@index([status])
}

model LawyerLetterhead {
  id                    String    @id @default(cuid())
  lawyerId              String    @unique
  letterheadUrl         String
  stampUrl              String?
  signatureUrl          String?
  certificatePrefix     String    @default("WP")
  useCustomLetterhead   Boolean   @default(false)
  customLetterheadUrl   String?
  scannedLetterheadUrl  String?
  letterheadTemplateUrl String?
  headerHeight          Int?
  footerHeight          Int?
  contentAreaX          Int?
  contentAreaY          Int?
  contentAreaWidth      Int?
  contentAreaHeight     Int?
  boundariesManuallySet Boolean   @default(false)
  firmName              String
  firmAddress           String?
  firmPhone             String?
  firmEmail             String?
  licenseNumber         String
  isApproved            Boolean   @default(false)
  approvedBy            String?
  approvedAt            DateTime?
  isActive              Boolean   @default(true)
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  approver              User?     @relation("LetterheadApprover", fields: [approvedBy], references: [id])
  lawyer                User      @relation("LawyerLetterhead", fields: [lawyerId], references: [id])
}

model ServiceRequest {
  id                  String        @id @default(cuid())
  userId              String
  serviceCategory     String
  serviceTitle        String
  description         String
  estimatedBudget     Int
  estimatedFee        Int
  tier                String
  urgency             String
  phoneNumber         String
  email               String
  transactionValue    Int?
  dealValue           Int?
  claimAmount         Int?
  businessType        String?
  complexity          String?
  commitmentFeePaid   Boolean       @default(false)
  commitmentFeeAmount Int           @default(500)
  commitmentFeeTxId   String?
  status              RequestStatus @default(PENDING)
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  selectedLawyerId    String?
  completedAt         DateTime?
  confirmedAt         DateTime?
  rating              Int?
  feedback            String?
  quotes              LawyerQuote[]
  selectedLawyer      User?         @relation("SelectedLawyerRequests", fields: [selectedLawyerId], references: [id])
  user                User          @relation("ClientServiceRequests", fields: [userId], references: [id])

  @@index([userId])
  @@index([status])
  @@index([tier])
}

model LawyerQuote {
  id                  String         @id @default(cuid())
  serviceRequestId    String
  lawyerId            String
  connectionFeePaid   Boolean        @default(false)
  connectionFeeAmount Int
  connectionFeeTxId   String?
  proposedFee         Int
  proposedTimeline    String
  approach            String
  offersMilestones    Boolean        @default(false)
  milestones          Json?
  submittedAt         DateTime       @default(now())
  isSelected          Boolean        @default(false)
  lawyer              User           @relation("LawyerQuotes", fields: [lawyerId], references: [id])
  serviceRequest      ServiceRequest @relation(fields: [serviceRequestId], references: [id])

  @@index([serviceRequestId])
  @@index([lawyerId])
}

model LawyerWallet {
  id               String                    @id @default(cuid())
  lawyerId         String                    @unique
  balance          Decimal                   @default(0) @db.Decimal(10, 2)
  pendingBalance   Decimal                   @default(0) @db.Decimal(10, 2)
  availableBalance Decimal                   @default(0) @db.Decimal(10, 2)
  currency         String                    @default("KES")
  isActive         Boolean                   @default(true)
  createdAt        DateTime                  @default(now())
  updatedAt        DateTime                  @updatedAt
  lawyer           LawyerProfile             @relation(fields: [lawyerId], references: [id])
  transactions     LawyerWalletTransaction[]

  @@index([lawyerId])
}

model LawyerWalletTransaction {
  id                    String                @id @default(cuid())
  walletId              String
  type                  WalletTransactionType
  amount                Decimal               @db.Decimal(10, 2)
  balanceBefore         Decimal               @db.Decimal(10, 2)
  balanceAfter          Decimal               @db.Decimal(10, 2)
  status                TransactionStatus     @default(PENDING)
  paymentMethod         String?
  mpesaTransactionId    String?
  mpesaReceiptNumber    String?
  consultationBookingId String?
  marketplaceBookingId  String?
  description           String?
  metadata              Json?
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt
  consultationBooking   ConsultationBooking?  @relation(fields: [consultationBookingId], references: [id])
  wallet                LawyerWallet          @relation(fields: [walletId], references: [id])

  @@index([walletId, createdAt])
  @@index([type, status])
}

model ConsultationBooking {
  id                     String                    @id @default(cuid())
  clientId               String
  lawyerId               String
  scheduledStartTime     DateTime
  scheduledEndTime       DateTime
  duration               Int
  consultationType       ConsultationType
  clientPaymentAmount    Decimal                   @db.Decimal(10, 2)
  platformCommissionRate Decimal                   @db.Decimal(5, 2)
  platformCommission     Decimal                   @db.Decimal(10, 2)
  lawyerPayout           Decimal                   @db.Decimal(10, 2)
  clientPaymentStatus    PaymentStatus             @default(PENDING)
  mpesaTransactionId     String?
  mpesaReceiptNumber     String?
  clientPaidAt           DateTime?
  status                 ConsultationBookingStatus @default(PENDING_PAYMENT)
  actualStartTime        DateTime?
  actualEndTime          DateTime?
  lawyerConfirmed        Boolean                   @default(false)
  clientConfirmed        Boolean                   @default(false)
  lawyerConfirmedAt      DateTime?
  clientConfirmedAt      DateTime?
  payoutStatus           PayoutStatus              @default(PENDING)
  payoutTransactionId    String?
  paidToLawyerAt         DateTime?
  isEmergency            Boolean                   @default(false)
  emergencyNotes         String?
  createdByReceptionist  Boolean                   @default(false)
  receptionistId         String?
  callSid                String?
  callDuration           Int?
  callRecordingUrl       String?
  createdAt              DateTime                  @default(now())
  updatedAt              DateTime                  @updatedAt
  client                 User                      @relation("ClientConsultationBookings", fields: [clientId], references: [id])
  lawyer                 User                      @relation("LawyerConsultationBookings", fields: [lawyerId], references: [id])
  review                 ConsultationReview?
  walletTransactions     LawyerWalletTransaction[]

  @@index([lawyerId, scheduledStartTime])
  @@index([clientId, status])
  @@index([status, clientPaymentStatus])
}

model ConsultationReview {
  id             String              @id @default(cuid())
  bookingId      String              @unique
  rating         Int
  comment        String?
  wouldRecommend Boolean
  createdAt      DateTime            @default(now())
  booking        ConsultationBooking @relation(fields: [bookingId], references: [id])
}

model WithdrawalRequest {
  id                 String           @id @default(cuid())
  lawyerId           String
  amount             Decimal          @db.Decimal(10, 2)
  withdrawalMethod   WithdrawalMethod
  mpesaPhoneNumber   String?
  mpesaName          String?
  bankName           String?
  accountNumber      String?
  accountName        String?
  branchCode         String?
  status             WithdrawalStatus @default(PENDING)
  requestedAt        DateTime         @default(now())
  processedAt        DateTime?
  completedAt        DateTime?
  rejectionReason    String?
  processedBy        String?
  transactionId      String?
  mpesaTransactionId String?
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  lawyer             LawyerProfile    @relation(fields: [lawyerId], references: [id])

  @@index([lawyerId, status])
  @@index([status, requestedAt])
}

model EmergencyContact {
  id           String   @id @default(cuid())
  phoneNumber  String
  label        String
  isActive     Boolean  @default(true)
  displayOrder Int
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([isActive, displayOrder])
}

model Conversation {
  id           String                    @id @default(cuid())
  createdAt    DateTime                  @default(now())
  updatedAt    DateTime                  @updatedAt
  participants ConversationParticipant[]
  messages     Message[]
}

model ConversationParticipant {
  id             String       @id @default(cuid())
  conversationId String
  userId         String
  joinedAt       DateTime     @default(now())
  leftAt         DateTime?
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  user           User         @relation("ConversationParticipants", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([conversationId, userId])
  @@index([userId])
}

model Message {
  id             String              @id @default(cuid())
  conversationId String
  senderId       String
  content        String
  read           Boolean             @default(false)
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  deletedAt      DateTime?
  conversation   Conversation        @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender         User                @relation("DirectMessagesSent", fields: [senderId], references: [id], onDelete: Cascade)
  attachments    MessageAttachment[]

  @@index([conversationId, createdAt])
  @@index([senderId])
}

model MessageAttachment {
  id        String   @id @default(cuid())
  messageId String
  fileName  String
  fileUrl   String
  fileSize  Int
  mimeType  String
  createdAt DateTime @default(now())
  message   Message  @relation(fields: [messageId], references: [id], onDelete: Cascade)

  @@index([messageId])
}

model LegalDocument {
  id            String    @id @default(cuid())
  title         String
  documentType  String
  category      String
  citation      String?
  sourceUrl     String?
  effectiveDate DateTime?
  filePath      String
  fileName      String
  fileSize      Int
  chunksCount   Int       @default(0)
  vectorsCount  Int       @default(0)
  uploadedBy    String
  uploadedAt    DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  uploader      User      @relation("UploadedLegalDocuments", fields: [uploadedBy], references: [id])

  @@index([documentType])
  @@index([category])
  @@index([uploadedAt])
}

model CallLog {
  id                  String    @id @default(cuid())
  callerName          String
  callerPhone         String
  callerEmail         String?
  issueCategory       String
  issueDescription    String
  recommendation      String
  recommendationNotes String?
  handledBy           String
  callDuration        Int?
  followUpRequired    Boolean   @default(false)
  followUpDate        DateTime?
  status              String    @default("PENDING")
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  handler             User      @relation("HandledCallLogs", fields: [handledBy], references: [id])

  @@index([recommendation])
  @@index([status])
  @@index([createdAt])
  @@index([handledBy])
}

model PageView {
  id           String   @id @default(cuid())
  sessionId    String
  userId       String?
  page         String
  pageName     String?
  referrer     String?
  userAgent    String?
  ipAddress    String?
  country      String?
  city         String?
  deviceType   String?
  browser      String?
  os           String?
  screenWidth  Int?
  screenHeight Int?
  duration     Int?
  scrollDepth  Int?
  exitPage     Boolean  @default(false)
  createdAt    DateTime @default(now())

  @@index([sessionId, createdAt])
  @@index([userId, createdAt])
  @@index([page])
  @@index([createdAt])
  @@index([country, city])
}

model UserEvent {
  id            String   @id @default(cuid())
  sessionId     String
  userId        String?
  eventType     String
  eventCategory String
  eventName     String
  page          String
  targetElement String?
  eventValue    Float?
  metadata      Json?
  searchQuery   String?
  lawyerId      String?
  serviceType   String?
  documentId    String?
  createdAt     DateTime @default(now())

  @@index([sessionId, createdAt])
  @@index([userId, createdAt])
  @@index([eventType, eventName])
  @@index([searchQuery])
  @@index([lawyerId])
  @@index([createdAt])
}

model UserSession {
  id               String    @id @default(cuid())
  sessionId        String    @unique
  userId           String?
  startedAt        DateTime  @default(now())
  endedAt          DateTime?
  duration         Int?
  pageViewsCount   Int       @default(0)
  eventsCount      Int       @default(0)
  referralSource   String?
  referralCampaign String?
  referralMedium   String?
  landingPage      String?
  exitPage         String?
  converted        Boolean   @default(false)
  conversionType   String?
  conversionValue  Float?
  deviceType       String?
  browser          String?
  os               String?
  country          String?
  city             String?
  updatedAt        DateTime  @updatedAt

  @@index([sessionId])
  @@index([userId, startedAt])
  @@index([converted, conversionType])
  @@index([referralSource, referralMedium])
  @@index([startedAt])
}

model AnalyticsSummary {
  id                 String   @id @default(cuid())
  date               DateTime @unique @db.Date
  totalVisitors      Int      @default(0)
  totalPageViews     Int      @default(0)
  totalEvents        Int      @default(0)
  newUsers           Int      @default(0)
  returningUsers     Int      @default(0)
  averageSessionTime Int      @default(0)
  bounceRate         Float    @default(0)
  conversionRate     Float    @default(0)
  totalConversions   Int      @default(0)
  totalRevenue       Float    @default(0)
  topPages           Json?
  topSearches        Json?
  topReferrers       Json?
  deviceBreakdown    Json?
  geographicData     Json?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  @@index([date])
}

model LawyerProfileUser {
  A String
  B String

  @@unique([A, B], map: "_LawyerProfileUser_AB_unique")
  @@index([B], map: "_LawyerProfileUser_B_index")
  @@map("_LawyerProfileUser")
}

enum UserRole {
  PUBLIC
  LAWYER
  ADMIN
}

enum VerificationStatus {
  PENDING
  VERIFIED
  REJECTED
}

enum LawyerTier {
  LITE
  PRO
  FREE
}

enum PricingTier {
  ENTRY
  STANDARD
  PREMIUM
  ELITE
}

enum DocumentTier {
  BASIC
  FILLED
  CERTIFIED
}

enum DocumentStatus {
  DRAFT
  FILLED
  PENDING_REVIEW
  UNDER_REVIEW
  CONSULTATION_REQUIRED
  CONSULTATION_SCHEDULED
  REVISION_NEEDED
  CERTIFIED
  REJECTED
  REVIEWED
  FINALIZED
}

enum DocumentType {
  CONTRACT
  AGREEMENT
  CERTIFICATE
  COURT_FILING
  OTHER
}

enum DocumentSource {
  UPLOADED
  PURCHASED
  GENERATED
}

enum ApprovalStatus {
  PENDING
  APPROVED
  REJECTED
  FLAGGED
}

enum ServiceTypeEnum {
  VIDEO_CONSULTATION
  MARKETPLACE_SERVICE
  DOCUMENT_CERTIFICATION
}

enum SubscriptionStatus {
  PENDING
  ACTIVE
  CANCELLED
  EXPIRED
  FAILED
}

enum ServiceType {
  CONSULTATION
  DOCUMENT_DRAFTING
  LEGAL_REVIEW
  IP_FILING
  DISPUTE_MEDIATION
  CONTRACT_NEGOTIATION
}

enum ServiceStatus {
  ACTIVE
  PAUSED
  INACTIVE
}

enum BookingStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  COMPLETED
  PAID
  FAILED
  CANCELLED
  REFUNDED
}

enum PaymentMethod {
  MPESA
  STRIPE_CARD
  BANK_TRANSFER
  WALLET
}

enum RefundStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  REJECTED
}

enum VideoConsultationStatus {
  SCHEDULED
  ONGOING
  COMPLETED
  CANCELLED
}

enum WalletTransactionType {
  DEPOSIT
  WITHDRAWAL
  PAYMENT
  REFUND
  PAYOUT
  FEE
}

enum TransactionStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
}

enum NotificationType {
  BOOKING_CREATED
  BOOKING_CONFIRMED
  BOOKING_CANCELLED
  PAYMENT_RECEIVED
  PAYMENT_FAILED
  MESSAGE_RECEIVED
  SERVICE_REVIEW
  SYSTEM_ANNOUNCEMENT
  CERTIFICATION_AVAILABLE
  CERTIFICATION_COMPLETED
  CERTIFICATION_REJECTED
  REVISION_REQUESTED
  CONSULTATION_SCHEDULED
  CONSULTATION_COMPLETED
}

enum ChatStatus {
  ACTIVE
  CLOSED
  ARCHIVED
}

enum MessageType {
  TEXT
  FILE
  IMAGE
  DOCUMENT
  SYSTEM
}

enum LegalDocumentType {
  CONSTITUTION
  ACT
  REGULATION
  CASE_LAW
  PROCEDURE
  FORM
  GUIDELINE
  TREATY
}

enum MarketplaceServiceStatus {
  ACTIVE
  INACTIVE
  ARCHIVED
}

enum MarketplaceServiceType {
  CONSULTATION
  DOCUMENT_DRAFTING
  LEGAL_REVIEW
  IP_FILING
  DISPUTE_MEDIATION
  CONTRACT_NEGOTIATION
}

enum PaymentType {
  FEATURE
  ARTICLE
  SUBSCRIPTION
  DOCUMENT
}

enum ServiceBookingStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum SubscriptionPlan {
  MONTHLY
  YEARLY
}

enum VideoConsultationType {
  CONSULTATION
  DOCUMENT_REVIEW
  CASE_ANALYSIS
}

enum DocumentOrigin {
  MARKETPLACE
  EXTERNAL
}

enum DocumentCategory {
  EMPLOYMENT_CONTRACT
  RENTAL_AGREEMENT
  BUSINESS_CONTRACT
  PARTNERSHIP_AGREEMENT
  COURT_DOCUMENT
  COMPANY_REGISTRATION
  MEMORANDUM
  POWER_OF_ATTORNEY
  LEASE_AGREEMENT
  SALES_AGREEMENT
  OTHER
}

enum ReviewType {
  AI_ONLY
  CERTIFICATION
  AI_PLUS_CERTIFICATION
}

enum AIReviewStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

enum CertificationStatus {
  PENDING_ASSIGNMENT
  ASSIGNED
  IN_REVIEW
  PENDING_QC
  QC_APPROVED
  QC_REJECTED
  COMPLETED
  REVISION_REQUESTED
}

enum QualityControlStatus {
  PENDING
  APPROVED
  REJECTED
  REVISION_REQUIRED
}

enum UrgencyLevel {
  EXPRESS
  STANDARD
  ECONOMY
}

enum RequestStatus {
  PENDING
  QUOTES_RECEIVED
  LAWYER_SELECTED
  IN_PROGRESS
  COMPLETED
  CONFIRMED
  CANCELLED
}

enum ConsultationType {
  VIDEO_CALL
  PHONE_CALL
  IN_PERSON
}

enum ConsultationBookingStatus {
  PENDING_PAYMENT
  PAYMENT_CONFIRMED
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  REFUNDED
}

enum PayoutStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

enum WithdrawalMethod {
  MPESA
  BANK_TRANSFER
}

enum WithdrawalStatus {
  PENDING
  APPROVED
  PROCESSING
  COMPLETED
  REJECTED
  FAILED
  CANCELLED
}

model ContactSubmission {
  id        String   @id @default(cuid())
  name      String
  email     String
  phone     String?
  subject   String
  message   String   @db.Text
  status    ContactStatus @default(PENDING)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([email])
  @@index([status])
  @@index([createdAt])
}

enum ContactStatus {
  PENDING
  RESPONDED
  RESOLVED
  CLOSED
}

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AppSetting {
  id        String   @id
  key       String   @unique
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime
}

model DocumentTemplate {
  id                 String              @id @default(cuid())
  type               String
  name               String
  description        String
  template           String
  priceKES           Int?
  isActive           Boolean?            @default(true)
  isPublic           Boolean?            @default(false)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  consultationId     String
  url                String
  fileName           String?
  storageKey         String?
  uploadedAt         DateTime?
  duration           Int?
  fileSize           Int?
  format             String?
  recordingStartedAt DateTime?
  DocumentPurchase   DocumentPurchase[]
  DocumentVersion    DocumentVersion[]
  Payment            Payment[]
  PurchaseLimit      PurchaseLimit[]
  VideoConsultation  VideoConsultation[]
  DocumentReview     DocumentReview[]
}

model DocumentPurchase {
  id               String           @id @default(cuid())
  userId           String
  amount           Float
  type             String
  content          String
  description      String
  status           String           @default("PENDING")
  template         String
  createdAt        DateTime         @default(now())
  updatedAt        DateTime
  referenceId      String?
  bookingId        String?
  documentId       String
  ServiceBooking   ServiceBooking?  @relation(fields: [bookingId], references: [id])
  DocumentTemplate DocumentTemplate @relation(fields: [documentId], references: [id])
  user             User             @relation("UserDocumentPurchases", fields: [userId], references: [id])
}

model ConsultationRecording {
  id                                        String            @id @default(cuid())
  clientId                                  String
  consultationId                            String
  url                                       String
  fileName                                  String?
  storageKey                                String?
  lawyerId                                  String
  uploadedAt                                DateTime?
  createdAt                                 DateTime          @default(now())
  duration                                  Int?
  fileSize                                  Int?
  format                                    String?
  recordingStartedAt                        DateTime?
  recordingEndedAt                          DateTime?
  User_ConsultationRecording_clientIdToUser User              @relation("ConsultationRecording_clientIdToUser", fields: [clientId], references: [id])
  VideoConsultation                         VideoConsultation @relation(fields: [consultationId], references: [id])
  User_ConsultationRecording_lawyerIdToUser User              @relation("ConsultationRecording_lawyerIdToUser", fields: [lawyerId], references: [id])
}

model DeviceRegistration {
  id          String    @id @default(cuid())
  userId      String
  deviceId    String
  deviceToken String?
  platform    String
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  appVersion  String?
  lastSeen    DateTime?
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model RefreshToken {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  createdAt DateTime @default(now())
  expiresAt DateTime
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model LawyerProfile {
  profileImageUrl                     String?
  updatedAt                           DateTime         @updatedAt
  bio                                 String?
  yearsOfExperience                   Int?
  availability                        Json?
  linkedInProfile                     String?
  id                                  String           @id @default(cuid())
  providerId                          String           @unique
  userId                              String           @unique
  licenseNumber                       String?          @unique
  tier                                LawyerTier?      @default(LITE)
  specializations                     String[]
  phoneNumber                         String?
  yearOfAdmission                     Int?
  location                            String?
  isVerified                          Boolean          @default(false)
  rating                              Float?           @default(0)
  reviewCount                         Int?             @default(0)
  isFeatured                          Boolean          @default(false)
  featuredUntil                       DateTime?
  status                              String?          @default("ACTIVE")
  createdAt                           DateTime         @default(now())
  User_LawyerProfile_providerIdToUser User             @relation("LawyerProfile_providerIdToUser", fields: [providerId], references: [id])
  user                                User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  ServiceBooking                      ServiceBooking[]
  User_LawyerProfileUser              User[]           @relation("LawyerProfileUser")
}

model User {
  id                                                         String                  @id @default(cuid())
  createdAt                                                  DateTime                @default(now())
  email                                                      String                  @unique
  emailVerified                                              Boolean                 @default(false)
  firstName                                                  String
  lastName                                                   String
  password                                                   String?
  passwordResetExpires                                       DateTime?
  passwordResetToken                                         String?
  phoneNumber                                                String?
  profileImageUrl                                            String?
  role                                                       String
  updatedAt                                                  DateTime                @updatedAt
  verificationStatus                                         String?                 @default("PENDING")
  googleId                                                   String?                 @unique
  facebookId                                                 String?                 @unique
  appleId                                                    String?                 @unique
  provider                                                   String?
  avatar                                                     String?
  aiQueries                                                  AIQuery[]               @relation("UserAIQueries")
  Article                                                    Article[]
  AuditLog                                                   AuditLog[]
  Badge                                                      Badge[]
  ChatMessage_ChatMessage_clientIdToUser                     ChatMessage[]           @relation("ChatMessage_clientIdToUser")
  messagesSent                                               ChatMessage[]           @relation("MessageSender")
  chatRoomsAsClient                                          ChatRoom[]              @relation("ChatClient")
  chatRoomsAsLawyer                                          ChatRoom[]              @relation("ChatLawyer")
  ConsultationRecording_ConsultationRecording_clientIdToUser ConsultationRecording[] @relation("ConsultationRecording_clientIdToUser")
  ConsultationRecording_ConsultationRecording_lawyerIdToUser ConsultationRecording[] @relation("ConsultationRecording_lawyerIdToUser")
  deviceRegistrations                                        DeviceRegistration[]
  documentPurchases                                          DocumentPurchase[]      @relation("UserDocumentPurchases")
  Favorite                                                   Favorite[]
  FeatureEvent                                               FeatureEvent[]
  LawyerProfile_LawyerProfile_providerIdToUser               LawyerProfile?          @relation("LawyerProfile_providerIdToUser")
  lawyerProfile                                              LawyerProfile?
  LawyerSubscription                                         LawyerSubscription[]
  LoyaltyPoint                                               LoyaltyPoint[]
  servicesOffered                                            MarketplaceService[]    @relation("ServiceProvider")
  notifications                                              Notification[]
  payments                                                   Payment[]
  PurchaseLimit                                              PurchaseLimit[]
  Referral_Referral_refereeIdToUser                          Referral[]              @relation("Referral_refereeIdToUser")
  Referral_Referral_referrerIdToUser                         Referral[]              @relation("Referral_referrerIdToUser")
  refreshTokens                                              RefreshToken[]
  refundsRequested                                           Refund[]
  bookingsAsClient                                           ServiceBooking[]        @relation("ServiceClient")
  ServiceBooking_ServiceBooking_lawyerIdToUser               ServiceBooking[]        @relation("ServiceBooking_lawyerIdToUser")
  bookingsAsProvider                                         ServiceBooking[]        @relation("ServiceProvider")
  ServiceBooking_ServiceBooking_userIdToUser                 ServiceBooking[]        @relation("ServiceBooking_userIdToUser")
  reviewsGiven                                               ServiceReview[]         @relation("ReviewAuthor")
  reviewsReceived                                            ServiceReview[]         @relation("ReviewTarget")
  profile                                                    UserProfile?
  clientConsultations                                        VideoConsultation[]     @relation("ClientConsultations")
  lawyerConsultations                                        VideoConsultation[]     @relation("LawyerConsultations")
  VideoConsultation_VideoConsultation_providerIdToUser       VideoConsultation[]     @relation("VideoConsultation_providerIdToUser")
  VideoConsultation_VideoConsultation_userIdToUser           VideoConsultation[]     @relation("VideoConsultation_userIdToUser")
  videoParticipants                                          VideoParticipant[]
  walletTransactions                                         WalletTransaction[]
  LawyerProfile_LawyerProfileUser                            LawyerProfile[]         @relation("LawyerProfileUser")
  documentReviewsAsUser                                      DocumentReview[]        @relation("DocumentReviewUser")
  documentReviewsAsLawyer                                    DocumentReview[]        @relation("DocumentReviewLawyer")
  documentReviewsAsQC                                        DocumentReview[]        @relation("DocumentReviewQC")
  lawyerLetterhead                                           LawyerLetterhead?       @relation("LawyerLetterhead")
  letterheadApprovals                                        LawyerLetterhead[]      @relation("LetterheadApprover")
  clientServiceRequests                                      ServiceRequest[]        @relation("ClientServiceRequests")
  selectedLawyerRequests                                     ServiceRequest[]        @relation("SelectedLawyerRequests")
  lawyerQuotes                                               LawyerQuote[]           @relation("LawyerQuotes")
}

model UserProfile {
  id        String   @id @default(cuid())
  userId    String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VideoParticipant {
  id                String            @id @default(uuid())
  consultationId    String
  userId            String
  participantType   String?
  connectionStatus  String?           @default("DISCONNECTED")
  hasVideo          Boolean           @default(false)
  joinedAt          DateTime          @default(now())
  leftAt            DateTime?
  isActive          Boolean           @default(true)
  hasAudio          Boolean           @default(false)
  videoConsultation VideoConsultation @relation(fields: [consultationId], references: [id])
  user              User              @relation(fields: [userId], references: [id], map: "VideoParticipant_userId_as_participant_fkey")
}

model MarketplaceService {
  id                    String                   @id @default(cuid())
  title                 String
  type                  MarketplaceServiceType
  providerId            String
  description           String?
  price                 Float
  priceKES              Int?
  tags                  String[]
  status                MarketplaceServiceStatus @default(ACTIVE)
  rating                Float?                   @default(0)
  createdAt             DateTime                 @default(now())
  externalTransactionId String?
  updatedAt             DateTime                 @updatedAt
  duration              Int?
  deliveryTimeframe     String?
  provider              User                     @relation("ServiceProvider", fields: [providerId], references: [id], onDelete: Cascade)
  bookings              ServiceBooking[]
  reviews               ServiceReview[]
}

model ServiceBooking {
  id                                 String               @id @default(cuid())
  userId                             String
  lawyerId                           String
  clientId                           String?
  providerId                         String
  serviceId                          String
  status                             ServiceBookingStatus
  scheduledAt                        DateTime
  completedAt                        DateTime?
  createdAt                          DateTime             @default(now())
  updatedAt                          DateTime             @updatedAt
  totalAmountKES                     Int?
  paymentStatus                      PaymentStatus?
  clientRequirements                 String?
  providerNotes                      String?
  chatRooms                          ChatRoom[]
  DocumentPurchase                   DocumentPurchase[]
  payments                           Payment[]
  client                             User?                @relation("ServiceClient", fields: [clientId], references: [id])
  User_ServiceBooking_lawyerIdToUser User                 @relation("ServiceBooking_lawyerIdToUser", fields: [lawyerId], references: [id], onDelete: Cascade)
  LawyerProfile                      LawyerProfile        @relation(fields: [lawyerId], references: [providerId], map: "ServiceBooking_lawyerProfileId_fkey")
  provider                           User                 @relation("ServiceProvider", fields: [providerId], references: [id])
  service                            MarketplaceService   @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  User_ServiceBooking_userIdToUser   User                 @relation("ServiceBooking_userIdToUser", fields: [userId], references: [id], onDelete: Cascade)
  videoConsultation                  VideoConsultation[]
  WalletTransaction                  WalletTransaction[]
}

model ServiceReview {
  id        String             @id @default(cuid())
  serviceId String
  authorId  String
  targetId  String
  rating    Int
  comment   String
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt
  author    User               @relation("ReviewAuthor", fields: [authorId], references: [id])
  target    User               @relation("ReviewTarget", fields: [targetId], references: [id])
  service   MarketplaceService @relation(fields: [serviceId], references: [id])
}

model Payment {
  priceKES              Int?
  createdAt             DateTime           @default(now())
  updatedAt             DateTime           @updatedAt
  appVersion            String?
  lastSeen              DateTime?
  id                    String             @id @default(cuid())
  userId                String
  documentId            String?
  bookingId             String
  type                  PaymentType
  targetId              String?
  amount                Int
  status                PaymentStatus
  provider              String
  transactionId         String?
  method                PaymentMethod?
  externalTransactionId String?
  verifiedAt            DateTime?
  metadata              Json?
  EscrowTransaction     EscrowTransaction?
  booking               ServiceBooking     @relation(fields: [bookingId], references: [id])
  DocumentTemplate      DocumentTemplate?  @relation(fields: [documentId], references: [id])
  user                  User               @relation(fields: [userId], references: [id])
  refunds               Refund[]
}

model Refund {
  releasedAt       DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  id               String    @id @default(cuid())
  paymentId        String
  userId           String
  amount           Float
  reason           String
  status           String
  externalRefundId String?
  requestedBy      String?
  payment          Payment   @relation(fields: [paymentId], references: [id], onDelete: Cascade)
  user             User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model WalletTransaction {
  referenceId    String?
  id             String          @id @default(cuid())
  userId         String
  amount         Float
  type           String
  status         String
  description    String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  bookingId      String?
  ServiceBooking ServiceBooking? @relation(fields: [bookingId], references: [id])
  user           User            @relation(fields: [userId], references: [id])
}

model Notification {
  id        String           @id @default(cuid())
  userId    String
  type      NotificationType
  title     String?
  message   String?
  createdAt DateTime         @default(now())
  isRead    Boolean          @default(false)
  readAt    DateTime?
  user      User             @relation(fields: [userId], references: [id])
}

model ChatRoom {
  id           String         @id @default(cuid())
  name         String
  clientId     String
  lawyerId     String
  bookingId    String
  status       String         @default("ACTIVE")
  lastActivity DateTime?      @default(now())
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  messages     ChatMessage[]
  booking      ServiceBooking @relation(fields: [bookingId], references: [id])
  client       User           @relation("ChatClient", fields: [clientId], references: [id], onDelete: Cascade)
  lawyer       User           @relation("ChatLawyer", fields: [lawyerId], references: [id], onDelete: Cascade)
}

model ChatMessage {
  id                              String    @id @default(cuid())
  roomId                          String
  senderId                        String
  clientId                        String
  messageType                     String    @default("TEXT")
  content                         String?
  fileUrl                         String?
  fileName                        String?
  fileSize                        Int?
  isRead                          Boolean   @default(false)
  createdAt                       DateTime  @default(now())
  editedAt                        DateTime?
  User_ChatMessage_clientIdToUser User      @relation("ChatMessage_clientIdToUser", fields: [clientId], references: [id])
  room                            ChatRoom  @relation(fields: [roomId], references: [id])
  sender                          User      @relation("MessageSender", fields: [senderId], references: [id], onDelete: Cascade)
}

model VideoConsultation {
  duration                                Int?
  id                                      String                  @id @default(uuid())
  roomId                                  String                  @unique
  userId                                  String
  amount                                  Float
  type                                    VideoConsultationType
  status                                  VideoConsultationStatus
  description                             String?
  createdAt                               DateTime                @default(now())
  updatedAt                               DateTime                @updatedAt
  referenceId                             String?
  startedAt                               DateTime?
  scheduledAt                             DateTime?
  endedAt                                 DateTime?
  isRecorded                              Boolean?                @default(false)
  bookingId                               String?
  documentId                              String
  providerId                              String?
  clientId                                String?
  lawyerId                                String?
  participantCount                        Int?
  ConsultationRecording                   ConsultationRecording[]
  booking                                 ServiceBooking?         @relation(fields: [bookingId], references: [id])
  client                                  User?                   @relation("ClientConsultations", fields: [clientId], references: [id])
  DocumentTemplate                        DocumentTemplate        @relation(fields: [documentId], references: [id])
  lawyer                                  User?                   @relation("LawyerConsultations", fields: [lawyerId], references: [id])
  User_VideoConsultation_providerIdToUser User?                   @relation("VideoConsultation_providerIdToUser", fields: [providerId], references: [id])
  User_VideoConsultation_userIdToUser     User                    @relation("VideoConsultation_userIdToUser", fields: [userId], references: [id])
  participants                            VideoParticipant[]
}

model AIQuery {
  id        String   @id @default(cuid())
  userId    String
  query     String
  createdAt DateTime @default(now())
  user      User     @relation("UserAIQueries", fields: [userId], references: [id], onDelete: Cascade)
}

model Article {
  authorId     String
  id           String    @id
  title        String
  content      String
  fileName     String?
  isPremium    Boolean   @default(false)
  premiumUntil DateTime?
  isPublished  Boolean   @default(false)
  User         User      @relation(fields: [authorId], references: [id], onDelete: Cascade)
}

model AuditLog {
  id     String @id
  userId String
  User   User   @relation(fields: [userId], references: [id])
}

model Badge {
  id        String   @id
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime
  User      User     @relation(fields: [userId], references: [id])
}

model DocumentVersion {
  id               String           @id
  documentId       String
  DocumentTemplate DocumentTemplate @relation(fields: [documentId], references: [id])
}

model EscrowTransaction {
  status      String?
  createdAt   DateTime  @default(now())
  id          String    @id
  paymentId   String    @unique
  amount      Float
  updatedAt   DateTime
  releaseDate DateTime?
  Payment     Payment   @relation(fields: [paymentId], references: [id])
}

model Favorite {
  id     String @id
  userId String
  User   User   @relation(fields: [userId], references: [id])
}

model FeatureEvent {
  id        String   @id
  userId    String
  type      String
  details   Json?
  createdAt DateTime @default(now())
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model LawyerSubscription {
  id          String             @id
  userId      String
  plan        SubscriptionPlan
  status      SubscriptionStatus @default(PENDING)
  priceKES    Int
  startDate   DateTime
  endDate     DateTime
  paymentInfo Json?
  updatedAt   DateTime
  User        User               @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model LoyaltyPoint {
  id        String   @id
  userId    String
  points    Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model PurchaseLimit {
  id               String            @id
  userId           String
  templateId       String?
  updatedAt        DateTime
  DocumentTemplate DocumentTemplate? @relation(fields: [templateId], references: [id])
  User             User              @relation(fields: [userId], references: [id])
}

model Referral {
  id                             String @id
  referrerId                     String
  refereeId                      String
  User_Referral_refereeIdToUser  User   @relation("Referral_refereeIdToUser", fields: [refereeId], references: [id])
  User_Referral_referrerIdToUser User   @relation("Referral_referrerIdToUser", fields: [referrerId], references: [id])
}

enum UserRole {
  PUBLIC
  LAWYER
  ADMIN
}

enum VerificationStatus {
  PENDING
  VERIFIED
  REJECTED
}

enum LawyerTier {
  LITE
  PRO
  FREE
}

enum PricingTier {
  ENTRY
  STANDARD
  PREMIUM
  ELITE
}

enum DocumentTier {
  BASIC
  FILLED
  CERTIFIED
}

enum DocumentStatus {
  DRAFT
  FILLED
  PENDING_REVIEW
  UNDER_REVIEW
  CONSULTATION_REQUIRED
  CONSULTATION_SCHEDULED
  REVISION_NEEDED
  CERTIFIED
  REJECTED
}

enum ApprovalStatus {
  PENDING
  APPROVED
  REJECTED
  FLAGGED
}

enum ServiceTypeEnum {
  VIDEO_CONSULTATION
  MARKETPLACE_SERVICE
  DOCUMENT_CERTIFICATION
}

enum SubscriptionStatus {
  PENDING
  ACTIVE
  CANCELLED
  EXPIRED
  FAILED
}

enum ServiceType {
  CONSULTATION
  DOCUMENT_DRAFTING
  LEGAL_REVIEW
  IP_FILING
  DISPUTE_MEDIATION
  CONTRACT_NEGOTIATION
}

enum ServiceStatus {
  ACTIVE
  PAUSED
  INACTIVE
}

enum BookingStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  CANCELLED
}

enum PaymentMethod {
  MPESA
  STRIPE_CARD
  BANK_TRANSFER
  WALLET
}

enum RefundStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  REJECTED
}

enum VideoConsultationStatus {
  SCHEDULED
  ONGOING
  COMPLETED
  CANCELLED
}

enum WalletTransactionType {
  DEPOSIT
  WITHDRAWAL
  PAYMENT
  REFUND
  PAYOUT
  FEE
}

enum TransactionStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
}

enum NotificationType {
  BOOKING_CREATED
  BOOKING_CONFIRMED
  BOOKING_CANCELLED
  PAYMENT_RECEIVED
  PAYMENT_FAILED
  MESSAGE_RECEIVED
  SERVICE_REVIEW
  SYSTEM_ANNOUNCEMENT
  CERTIFICATION_AVAILABLE
  CERTIFICATION_COMPLETED
  CERTIFICATION_REJECTED
  REVISION_REQUESTED
  CONSULTATION_SCHEDULED
  CONSULTATION_COMPLETED
}

enum ChatStatus {
  ACTIVE
  CLOSED
  ARCHIVED
}

enum MessageType {
  TEXT
  FILE
  IMAGE
  DOCUMENT
  SYSTEM
}

enum LegalDocumentType {
  CONSTITUTION
  ACT
  REGULATION
  CASE_LAW
  PROCEDURE
  FORM
  GUIDELINE
  TREATY
}

enum MarketplaceServiceStatus {
  ACTIVE
  INACTIVE
  ARCHIVED
}

enum MarketplaceServiceType {
  CONSULTATION
  DOCUMENT_DRAFTING
  LEGAL_REVIEW
  IP_FILING
  DISPUTE_MEDIATION
  CONTRACT_NEGOTIATION
}

enum PaymentType {
  FEATURE
  ARTICLE
  SUBSCRIPTION
  DOCUMENT
}

enum ServiceBookingStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum SubscriptionPlan {
  MONTHLY
  YEARLY
}

enum VideoConsultationType {
  CONSULTATION
  DOCUMENT_REVIEW
  CASE_ANALYSIS
}

model DocumentReview {
  id                    String                  @id @default(cuid())
  userId                String
  lawyerId              String?
  documentSource        DocumentSource
  marketplaceDocumentId String?
  uploadedDocumentUrl   String?
  originalFileName      String?
  documentType          String
  documentCategory      DocumentCategory?
  
  reviewType            ReviewType
  aiReviewStatus        AIReviewStatus          @default(PENDING)
  aiReviewResults       Json?
  aiReviewCompletedAt   DateTime?
  
  certificationStatus   CertificationStatus?
  certificationPrice    Float?
  certifiedDocumentUrl  String?
  certificationLetterUrl String?
  lawyerNotes           String?
  
  // Digital Certification Fields
  certificateId         String?   @unique     // Unique verification ID (e.g., "WP-2024-ABC123")
  verificationQRCodeUrl String?               // QR code image for verification
  signedAt              DateTime?             // When lawyer signed the document
  signatureApplied      Boolean   @default(false)
  stampApplied          Boolean   @default(false)
  letterheadApplied     Boolean   @default(false)
  
  questionnaire         Json?
  urgency               UrgencyLevel            @default(STANDARD)
  deadline              DateTime
  
  price                 Float
  paymentId             String?
  paidAt                DateTime?
  
  qualityControlStatus  QualityControlStatus?
  qualityControlNotes   String?
  qualityCheckedBy      String?
  qualityCheckedAt      DateTime?
  
  completedAt           DateTime?
  deliveredAt           DateTime?
  clientRating          Int?
  clientFeedback        String?
  
  revisionCount         Int                     @default(0)
  revisionRequested     Boolean                 @default(false)
  revisionNotes         String?
  
  createdAt             DateTime                @default(now())
  updatedAt             DateTime                @updatedAt
  
  user                  User                    @relation("DocumentReviewUser", fields: [userId], references: [id])
  lawyer                User?                   @relation("DocumentReviewLawyer", fields: [lawyerId], references: [id])
  marketplaceDocument   DocumentTemplate?       @relation(fields: [marketplaceDocumentId], references: [id])
  qualityController     User?                   @relation("DocumentReviewQC", fields: [qualityCheckedBy], references: [id])
  
  @@index([userId])
  @@index([lawyerId])
  @@index([aiReviewStatus])
  @@index([certificationStatus])
  @@index([qualityControlStatus])
}

model LawyerLetterhead {
  id                String   @id @default(cuid())
  lawyerId          String   @unique
  letterheadUrl     String
  stampUrl          String?
  signatureUrl      String?              // Digital signature image
  certificatePrefix String   @default("WP") // Prefix for certificate IDs (e.g., "WP", "LSK")
  firmName          String
  firmAddress       String?
  firmPhone         String?
  firmEmail         String?
  licenseNumber     String
  
  isApproved        Boolean  @default(false)
  approvedBy        String?
  approvedAt        DateTime?
  
  isActive          Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  lawyer            User     @relation("LawyerLetterhead", fields: [lawyerId], references: [id])
  approver          User?    @relation("LetterheadApprover", fields: [approvedBy], references: [id])
}

enum DocumentSource {
  MARKETPLACE
  EXTERNAL
}

enum DocumentCategory {
  EMPLOYMENT_CONTRACT
  RENTAL_AGREEMENT
  BUSINESS_CONTRACT
  PARTNERSHIP_AGREEMENT
  COURT_DOCUMENT
  COMPANY_REGISTRATION
  MEMORANDUM
  POWER_OF_ATTORNEY
  LEASE_AGREEMENT
  SALES_AGREEMENT
  OTHER
}

enum ReviewType {
  AI_ONLY
  CERTIFICATION
  AI_PLUS_CERTIFICATION
}

enum AIReviewStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

enum CertificationStatus {
  PENDING_ASSIGNMENT
  ASSIGNED
  IN_REVIEW
  PENDING_QC
  QC_APPROVED
  QC_REJECTED
  COMPLETED
  REVISION_REQUESTED
}

enum QualityControlStatus {
  PENDING
  APPROVED
  REJECTED
  REVISION_REQUIRED
}

enum UrgencyLevel {
  EXPRESS
  STANDARD
  ECONOMY
}

model ServiceRequest {
  id                    String         @id @default(cuid())
  userId                String
  serviceCategory       String
  serviceTitle          String
  description           String
  estimatedBudget       Int
  estimatedFee          Int
  tier                  String
  urgency               String
  phoneNumber           String
  email                 String
  transactionValue      Int?
  dealValue             Int?
  claimAmount           Int?
  businessType          String?
  complexity            String?
  commitmentFeePaid     Boolean        @default(false)
  commitmentFeeAmount   Int            @default(500)
  commitmentFeeTxId     String?
  status                RequestStatus  @default(PENDING)
  createdAt             DateTime       @default(now())
  updatedAt             DateTime       @updatedAt
  selectedLawyerId      String?
  user                  User           @relation("ClientServiceRequests", fields: [userId], references: [id])
  selectedLawyer        User?          @relation("SelectedLawyerRequests", fields: [selectedLawyerId], references: [id])
  quotes                LawyerQuote[]
  completedAt           DateTime?
  confirmedAt           DateTime?
  rating                Int?
  feedback              String?

  @@index([userId])
  @@index([status])
  @@index([tier])
}

model LawyerQuote {
  id                  String         @id @default(cuid())
  serviceRequestId    String
  lawyerId            String
  connectionFeePaid   Boolean        @default(false)
  connectionFeeAmount Int
  connectionFeeTxId   String?
  proposedFee         Int
  proposedTimeline    String
  approach            String
  offersMilestones    Boolean        @default(false)
  milestones          Json?
  submittedAt         DateTime       @default(now())
  isSelected          Boolean        @default(false)
  serviceRequest      ServiceRequest @relation(fields: [serviceRequestId], references: [id])
  lawyer              User           @relation("LawyerQuotes", fields: [lawyerId], references: [id])

  @@index([serviceRequestId])
  @@index([lawyerId])
}

enum RequestStatus {
  PENDING
  QUOTES_RECEIVED
  LAWYER_SELECTED
  IN_PROGRESS
  COMPLETED
  CONFIRMED
  CANCELLED
}

# Wakili Pro - Deployment Guide

## üìã Workflow Overview

The Wakili Pro project uses multiple GitHub Actions workflows for different purposes. Here's a breakdown:

### Active Workflows

#### 1. **production-deploy-v2.yml** (PRIMARY DEPLOYMENT)
- **Purpose**: Main production deployment pipeline
- **Trigger**: Push to `main` branch, manual dispatch
- **Stages**:
  1. **Validate**: ESLint, TypeScript checks, tests
  2. **Build**: Production build with optimizations
  3. **Deploy**: Deploy to Vercel
  4. **Cleanup**: Post-deployment cleanup
- **Environment**: Production
- **Status**: ‚úÖ ACTIVE

#### 2. **ci-cd.yml** (CONTINUOUS INTEGRATION)
- **Purpose**: PR validation and CI checks
- **Trigger**: Pull requests to `main`, manual dispatch
- **Stages**: Frontend and backend tests, linting, type checking
- **Status**: ‚úÖ ACTIVE

### Backup/Legacy Workflows

#### 3. **deploy-vercel-backup.yml**
- **Purpose**: Backup deployment workflow
- **Trigger**: Manual dispatch only
- **Status**: ‚ö†Ô∏è BACKUP (Use for debugging)

#### 4. **deploy.yml**
- **Purpose**: GitHub Pages deployment (deprecated)
- **Trigger**: Manual dispatch only
- **Status**: üî¥ DISABLED (Vercel is primary)

#### 5. **ci.yml**
- **Purpose**: Basic CI pipeline
- **Trigger**: Depends on configuration
- **Status**: ‚ö†Ô∏è LEGACY

## üöÄ Deployment Process

### Automatic Deployment (Recommended)

1. **Commit and push to main branch**
   ```bash
   git add .
   git commit -m "feat: your feature description"
   git push origin main
   ```

2. **GitHub Actions automatically**:
   - Validates code quality (ESLint, TypeScript)
   - Runs tests
   - Builds the application
   - Deploys to Vercel
   - Performs health checks

### Manual Deployment

1. Go to **Actions** tab in GitHub
2. Select **"üöÄ Production Deployment Pipeline v2"**
3. Click **"Run workflow"**
4. Choose environment (production/staging)
5. Click **"Run workflow"** button

## üîß Vercel Configuration

### vercel.json Features

- **Framework**: Vite
- **Build Command**: `npm run build`
- **Output Directory**: `dist`
- **Caching Strategy**:
  - Static assets (1 year cache)
  - HTML (no cache for fresh updates)
- **Security Headers**:
  - X-Content-Type-Options
  - X-Frame-Options
  - X-XSS-Protection
  - Referrer-Policy
  - Permissions-Policy

### Required Secrets

Configure these in GitHub Settings ‚Üí Secrets:

- `VERCEL_TOKEN`: Vercel authentication token
- `VERCEL_ORG_ID`: Vercel organization ID
- `VERCEL_PROJECT_ID`: Vercel project ID

## üîç Troubleshooting

### Common Issues

#### 1. "DEPLOYMENT_URL context invalid" Error
**Fixed**: Now using `steps.deploy.outputs.deployment_url` instead of `env.DEPLOYMENT_URL`

#### 2. Build Failures
- Check Node.js version (should be 20.18.0)
- Verify all dependencies are installed
- Check for TypeScript errors

#### 3. Health Check Failures
- Verify the deployment URL is accessible
- Check Vercel deployment logs
- Ensure backend API is running

### Viewing Deployment Logs

1. **GitHub Actions**:
   - Go to Actions tab
   - Click on the workflow run
   - View detailed logs for each step

2. **Vercel Dashboard**:
   - Visit [vercel.com](https://vercel.com)
   - Select your project
   - View deployment logs

## üìä Deployment Checklist

Before deploying to production:

- [ ] All tests passing
- [ ] No TypeScript errors
- [ ] No ESLint warnings
- [ ] Build succeeds locally
- [ ] Environment variables configured
- [ ] Backend API is accessible
- [ ] Database migrations completed (if any)

## üåê Environments

### Production
- **URL**: Auto-generated by Vercel (*.vercel.app)
- **Backend**: https://wakili-pro.onrender.com/api
- **Branch**: main

### Staging (Optional)
- Can be triggered via manual workflow dispatch
- Useful for testing before production deployment

## üìû Support

For deployment issues:
1. Check GitHub Actions logs
2. Review Vercel deployment logs
3. Verify all secrets are configured
4. Contact the development team

## üîÑ Recent Fixes (November 2025)

- ‚úÖ Fixed DEPLOYMENT_URL context access errors
- ‚úÖ Optimized vercel.json configuration
- ‚úÖ Added comprehensive security headers
- ‚úÖ Improved caching strategy
- ‚úÖ Enhanced health check reliability
